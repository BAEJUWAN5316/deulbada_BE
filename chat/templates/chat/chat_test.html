<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Local WebSocket Test</title>
</head>
<body>
    <h1>ë°°í¬ì„œë²„ WebSocket í…ŒìŠ¤íŠ¸</h1>
    <button id="sendBtn">ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
    <ul id="messages"></ul>

    <script>
        let socket;

        // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM ë¡œë“œ ì™„ë£Œ");
            
            function addMessage(text) {
                const ul = document.getElementById("messages");
                if (!ul) {
                    console.error("messages ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                    return;
                }
                const li = document.createElement("li");
                li.textContent = new Date().toLocaleTimeString() + " - " + text;
                ul.appendChild(li);
                console.log("ë©”ì‹œì§€ ì¶”ê°€ë¨:", text);
            }

            function sendMessage() {
                if (socket && socket.readyState === WebSocket.OPEN) {
                    const message = { message: "ë¡œì»¬ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€" };
                    socket.send(JSON.stringify(message));
                    console.log("ğŸ“¤ ì „ì†¡í•œ ë©”ì‹œì§€:", message);
                    addMessage("ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: " + message.message);
                } else {
                    console.log("âŒ WebSocketì´ ì—°ê²°ë˜ì§€ ì•ŠìŒ");
                    addMessage("WebSocket ì—°ê²°ë˜ì§€ ì•ŠìŒ!");
                }
            }

            // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            const sendBtn = document.getElementById("sendBtn");
            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }

            // WebSocket ì—°ê²°
            socket = new WebSocket("ws://43.201.70.73/ws/chat/1/");

            socket.onopen = () => {
                console.log("âœ… ì—°ê²° ì„±ê³µ");
                addMessage("ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!");
            };

            socket.onmessage = (e) => {
                console.log("ğŸ“© ì›ë³¸ ë°ì´í„°:", e.data);
                try {
                    const data = JSON.parse(e.data);
                    console.log("ğŸ“© íŒŒì‹±ëœ ë°ì´í„°:", data);
                    addMessage(`[${data.sender}]: ${data.message}`);
                } catch (error) {
                    console.log("ğŸ“© JSON íŒŒì‹± ì‹¤íŒ¨, ì›ë³¸ í…ìŠ¤íŠ¸:", e.data);
                    addMessage("ë°›ì€ ë©”ì‹œì§€: " + e.data);
                }
            };

            socket.onerror = (e) => {
                console.error("âŒ ì˜¤ë¥˜:", e);
                addMessage("ì˜¤ë¥˜ ë°œìƒ!");
            };

            socket.onclose = (e) => {
                console.log("ğŸ”Œ ì—°ê²° ì¢…ë£Œ:", e.code, e.reason);
                addMessage(`ì—°ê²° ì¢…ë£Œë¨: ${e.code}`);
            };
        });
    </script>
</body>
</html>